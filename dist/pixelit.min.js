"use strict";function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,a){for(var e=0;e<a.length;e++){var i=a[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,a,e){return a&&_defineProperties(t.prototype,a),e&&_defineProperties(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var pixelit=function(){function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.drawto=a.to||document.getElementById("pixelitcanvas"),this.drawfrom=a.from||document.getElementById("pixelitimg"),this.hideFromImg(),this.scale=a.scale&&a.scale>0&&a.scale<=500?.01*a.scale:.08,this.palette=a.palette||[[140,143,174],[88,69,99],[62,33,55],[154,99,72],[215,155,125],[245,237,186],[192,199,65],[100,125,52],[228,148,58],[157,48,59],[210,100,113],[112,55,127],[126,196,193],[52,133,157],[23,67,75],[31,14,28]],this.maxHeight=a.maxHeight,this.maxWidth=a.maxWidth,this.ctx=this.drawto.getContext("2d"),this.endColorStats={}}return _createClass(t,[{key:"hideFromImg",value:function(){return this}},{key:"setFromImgSource",value:function(t){return this.drawfrom.src=t,this}},{key:"setDrawFrom",value:function(t){return this.drawfrom=t,this}},{key:"setDrawTo",value:function(t){return this.drawto=t,this}},{key:"setPalette",value:function(t){return this.palette=t,this}},{key:"setMaxWidth",value:function(t){return this.maxWidth=t,this}},{key:"setMaxHeight",value:function(t){return this.maxHeight=t,this}},{key:"setScale",value:function(t){return this.scale=t>0&&t<=500?.01*t:.08,this}},{key:"getPalette",value:function(){return this.palette}},{key:"colorSim",value:function(t,a){var e,i,h=0;for(e=0,i=t.length;e<i;e++)h+=(t[e]-a[e])*(t[e]-a[e]);return Math.sqrt(h)}},{key:"similarColor",value:function(t){var a,e=this,i=[],h=this.colorSim(t,this.palette[0]);return this.palette.forEach((function(r){(a=e.colorSim(t,r))<=h&&(i=r,h=a)})),i}},{key:"pixelate",value:function(){this.drawto.width=this.drawfrom.naturalWidth,this.drawto.height=this.drawfrom.naturalHeight;var t=this.drawto.width*this.scale,a=this.drawto.height*this.scale,e=document.createElement("canvas");e.width=this.drawto.width,e.height=this.drawto.height,e.style.position="fixed",e.style.top="0",e.style.left="0",(this.drawto.width>900||this.drawto.height>900)&&(this.scale*=.5,t=this.drawto.width*this.scale,a=this.drawto.height*this.scale,e.width=Math.max(t,a)+50,e.height=Math.max(t,a)+50),e.getContext("2d").drawImage(this.drawfrom,0,0,t,a),document.body.appendChild(e),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1;var i=this.drawfrom.naturalWidth;this.drawfrom.naturalWidth>300&&(i+=this.drawfrom.naturalWidth>this.drawfrom.naturalHeight?parseInt(this.drawfrom.naturalWidth/(this.drawfrom.naturalWidth*this.scale))/1.5:parseInt(this.drawfrom.naturalWidth/(this.drawfrom.naturalWidth*this.scale)));var h=this.drawfrom.naturalHeight;return this.drawfrom.naturalHeight>300&&(h+=this.drawfrom.naturalHeight>this.drawfrom.naturalWidth?parseInt(this.drawfrom.naturalHeight/(this.drawfrom.naturalHeight*this.scale))/1.5:parseInt(this.drawfrom.naturalHeight/(this.drawfrom.naturalHeight*this.scale))),this.ctx.drawImage(e,0,0,t,a,0,0,i,h),e.remove(),this}},{key:"convertGrayscale",value:function(){for(var t=this.drawto.width,a=this.drawto.height,e=this.ctx.getImageData(0,0,t,a),i=0;i<e.height;i++)for(var h=0;h<e.width;h++){var r=4*i*e.width+4*h,s=(e.data[r]+e.data[r+1]+e.data[r+2])/3;e.data[r]=s,e.data[r+1]=s,e.data[r+2]=s}return this.ctx.putImageData(e,0,0,0,0,e.width,e.height),this}},{key:"convertPalette",value:function(){for(var t=this.drawto.width,a=this.drawto.height,e=this.ctx.getImageData(0,0,t,a),i=0;i<e.height;i++)for(var h=0;h<e.width;h++){var r=4*i*e.width+4*h,s=this.similarColor([e.data[r],e.data[r+1],e.data[r+2]]);e.data[r]=s[0],e.data[r+1]=s[1],e.data[r+2]=s[2]}return this.ctx.putImageData(e,0,0,0,0,e.width,e.height),this}},{key:"resizeImage",value:function(){var t=document.createElement("canvas"),a=t.getContext("2d"),e=1;return this.maxWidth||this.maxHeight?(this.maxWidth&&this.drawto.width>this.maxWidth&&(e=this.maxWidth/this.drawto.width),this.maxHeight&&this.drawto.height>this.maxHeight&&(e=this.maxHeight/this.drawto.height),t.width=this.drawto.width,t.height=this.drawto.height,a.drawImage(this.drawto,0,0),this.drawto.width=this.drawto.width*e,this.drawto.height=this.drawto.height*e,this.ctx.drawImage(t,0,0,t.width,t.height,0,0,this.drawto.width,this.drawto.height),this):0}},{key:"draw",value:function(){return this.drawto.width=this.drawfrom.width,this.drawto.height=this.drawfrom.height,this.ctx.drawImage(this.drawfrom,0,0),this.resizeImage(),this}},{key:"saveImage",value:function(){var t=document.createElement("a");t.download="pxArt.png",t.href=this.drawto.toDataURL("image/png").replace("image/png","image/octet-stream"),document.querySelector("body").appendChild(t),t.click(),document.querySelector("body").removeChild(t)}}]),t}();